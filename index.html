<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora VES USDT</title>
    
    <!-- Metatags para PWA y Android -->
    <meta name="theme-color" content="#1d4ed8">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/5163/5163999.png">

    <!-- Manifest JSON inline (Data URL) -->
    <link rel="manifest" href='data:application/manifest+json,{"name":"Calculadora VES USDT","short_name":"CalculadoraVE","start_url":".","display":"standalone","background_color":"#ffffff","theme_color":"#1d4ed8","icons":[{"src":"https://cdn-icons-png.flaticon.com/512/5163/5163999.png","sizes":"512x512","type":"image/png","purpose":"any maskable"}]}'>

    <!-- Tailwind CSS para los estilos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons para los iconos -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        [x-cloak] { display: none !important; }
        .transition-all { transition: all 0.3s ease; }
        /* Evita el scroll elástico en móviles */
        body { overscroll-behavior-y: contain; }
    </style>
</head>
<body class="transition-colors duration-300 bg-slate-50 text-slate-800 font-sans pb-10" id="bodyTag">

    <!-- Header -->
    <header class="bg-blue-700 text-white p-4 shadow-lg sticky top-0 z-20 transition-colors duration-300" id="headerTag">
        <div class="max-w-md mx-auto flex items-center justify-between">
            <div class="flex items-center gap-2">
                <i data-lucide="calculator" class="w-6 h-6"></i>
                <h1 class="text-xl font-bold italic tracking-tight">Calculadora VES USDT</h1>
            </div>
            <button onclick="toggleDarkMode()" class="p-2 rounded-full bg-blue-800 text-blue-100 hover:scale-110 transition-transform" id="themeBtn">
                <i data-lucide="moon" size="20" id="themeIcon"></i>
            </button>
        </div>
    </header>

    <main class="max-w-md mx-auto p-4 space-y-6">

        <!-- Sección de Tasas -->
        <section class="bg-white border-slate-100 p-4 rounded-2xl shadow-sm border transition-colors duration-300" id="ratesCard">
            <div class="flex justify-between items-center mb-3">
                <h2 class="text-sm font-semibold text-slate-500 uppercase tracking-wider">Tasas Configuradas</h2>
                <span class="text-[10px] px-2 py-0.5 rounded bg-slate-100 text-slate-500 transition-colors duration-300" id="badgeLabel">Guardado Local</span>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div class="space-y-1">
                    <label class="text-xs text-slate-500 font-medium">BCV (Oficial)</label>
                    <input type="number" id="tasaBCV" value="46.50" oninput="updateRates()"
                        class="w-full p-2 rounded-lg font-bold text-lg focus:outline-none focus:ring-2 bg-blue-50 border-blue-100 text-blue-900 focus:ring-blue-500 transition-colors duration-300">
                </div>
                <div class="space-y-1">
                    <label class="text-xs text-slate-500 font-medium">USDT (Tether)</label>
                    <input type="number" id="tasaUSDT" value="54.20" oninput="updateRates()"
                        class="w-full p-2 rounded-lg font-bold text-lg focus:outline-none focus:ring-2 bg-green-50 border-green-100 text-green-900 focus:ring-green-500 transition-colors duration-300">
                </div>
            </div>
            <div class="mt-3 flex justify-between items-center text-xs p-2 rounded-lg bg-slate-50 text-slate-500 transition-colors duration-300" id="brechaBox">
                <span>Brecha cambiaria:</span>
                <span class="font-bold text-amber-500" id="brechaText">+0.00%</span>
            </div>
        </section>

        <!-- Input de Monto -->
        <section class="bg-white border-blue-500/20 p-6 rounded-2xl shadow-md border-2 transition-colors duration-300" id="inputCard">
            <div class="flex p-1 rounded-xl mb-6 bg-slate-100 transition-colors duration-300" id="selectorBox">
                <button onclick="setCurrency('BS')" id="btnBS" class="currency-btn flex-1 py-2 text-xs font-bold rounded-lg transition-all bg-white text-blue-700 shadow-sm scale-105">BS</button>
                <button onclick="setCurrency('USD')" id="btnUSD" class="currency-btn flex-1 py-2 text-xs font-bold rounded-lg transition-all text-slate-500">USD</button>
                <button onclick="setCurrency('USDT')" id="btnUSDT" class="currency-btn flex-1 py-2 text-xs font-bold rounded-lg transition-all text-slate-500">USDT</button>
            </div>

            <label class="text-sm font-bold mb-2 block text-slate-700 transition-colors duration-300" id="inputLabel">Monto en BS</label>
            <div class="relative">
                <input type="number" id="montoEntrada" oninput="calculate()"
                    class="w-full text-4xl font-bold placeholder-slate-600 border-b-2 bg-transparent focus:outline-none py-2 transition-colors border-slate-100 focus:border-blue-500"
                    placeholder="0.00">
            </div>
        </section>

        <!-- Resultados -->
        <div id="resultsArea" class="space-y-4 hidden">
            <div class="grid grid-cols-1 gap-3">
                <!-- Equivalente BS -->
                <div id="bsResultBox" class="bg-slate-800 text-white p-4 rounded-xl flex justify-between items-center shadow-lg">
                    <div>
                        <p class="text-slate-400 text-xs font-medium uppercase tracking-tighter">Equivalente en Bolívares</p>
                        <p class="text-2xl font-bold tracking-tight" id="valBS">Bs 0,00</p>
                    </div>
                    <div class="text-slate-500 font-black opacity-10 text-3xl italic text-white">BS</div>
                </div>

                <!-- Resultado BCV -->
                <div class="p-4 rounded-xl shadow-md flex justify-between items-center border bg-gradient-to-r from-blue-600 to-blue-500 text-white" id="bcvResultBox">
                    <div>
                        <p class="text-blue-100 text-xs font-medium uppercase tracking-tighter" id="bcvLabel">A Tasa BCV</p>
                        <p class="text-2xl font-bold tracking-tight" id="valUSD">$0.00</p>
                    </div>
                    <i data-lucide="trending-up" class="text-white/40 w-8 h-8"></i>
                </div>

                <!-- Resultado USDT -->
                <div class="p-4 rounded-xl shadow-sm flex justify-between items-center border bg-white border-slate-200" id="usdtResultCard">
                    <div>
                        <p class="text-slate-500 text-xs font-medium uppercase tracking-tighter">A Tasa USDT</p>
                        <p class="text-2xl font-bold tracking-tight text-slate-800" id="valUSDTDisplay">$0.00</p>
                    </div>
                    <div class="bg-green-100 p-2 rounded-lg transition-colors duration-300" id="usdtIconBg">
                        <i data-lucide="trending-down" class="text-green-500 w-6 h-6"></i>
                    </div>
                </div>
            </div>

            <!-- Comparativa Visual -->
            <div class="p-5 rounded-2xl shadow-sm border bg-white border-slate-100 transition-colors duration-300" id="graphCard">
                <h3 class="text-sm font-semibold mb-4 flex items-center gap-2 text-slate-700" id="graphTitle">
                    <i data-lucide="alert-circle" class="w-4 h-4"></i> Diferencia Real de Cambio
                </h3>
                
                <div class="space-y-4">
                    <div>
                        <div class="flex justify-between text-xs mb-1">
                            <span class="font-medium text-blue-500">Valor Oficial (BCV)</span>
                            <span class="text-slate-500" id="progUSD">$0.00</span>
                        </div>
                        <div class="w-full rounded-full h-2 bg-slate-100 transition-colors duration-300" id="progBarBg1">
                            <div class="bg-blue-600 h-2 rounded-full w-full shadow-[0_0_8px_rgba(37,99,235,0.4)]"></div>
                        </div>
                    </div>

                    <div>
                        <div class="flex justify-between text-xs mb-1">
                            <span class="font-medium text-green-500">Valor Real (USDT)</span>
                            <span class="text-slate-500" id="progUSDT">$0.00</span>
                        </div>
                        <div class="w-full rounded-full h-2 flex bg-slate-100 transition-colors duration-300" id="progBarBg2">
                            <div id="realProgress" class="bg-green-500 h-2 rounded-l-full shadow-[0_0_8px_rgba(34,197,94,0.4)]" style="width: 80%"></div>
                            <div class="bg-red-400 h-2 rounded-r-full flex-1"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer class="text-center space-y-2 opacity-40 pt-4 text-[10px] uppercase tracking-widest font-bold text-slate-400" id="footerText">
            Calculadora VE to USDT • By Luisgarcm
        </footer>

    </main>

    <script>
        // --- LOGICA DE SERVICE WORKER PARA PWA ---
        const swCode = `
            const CACHE_NAME = 'calc-ve-v1';
            self.addEventListener('install', e => {
                e.waitUntil(caches.open(CACHE_NAME).then(cache => cache.addAll(['/'])));
            });
            self.addEventListener('fetch', e => {
                e.respondWith(caches.match(e.request).then(res => res || fetch(e.request)));
            });
        `;
        
        if ('serviceWorker' in navigator) {
            const blob = new Blob([swCode], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);
            navigator.serviceWorker.register(swUrl).catch(err => console.log("SW no registrado", err));
        }

        let darkMode = false;
        let monedaEntrada = 'BS';

        // Formateadores
        const formatVEF = (amount) => new Intl.NumberFormat('es-VE', { style: 'currency', currency: 'VES' }).format(amount);
        const formatUSD = (amount) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount);

        // Inicializar
        window.onload = () => {
            const savedRates = localStorage.getItem('ve-calc-rates');
            if (savedRates) {
                const data = JSON.parse(savedRates);
                document.getElementById('tasaBCV').value = data.bcv || 46.50;
                document.getElementById('tasaUSDT').value = data.usdt || 54.20;
            }

            const savedTheme = localStorage.getItem('ve-calc-theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                toggleDarkMode(true);
            }

            updateRates();
            lucide.createIcons();
        };

        function toggleDarkMode(force) {
            darkMode = force !== undefined ? force : !darkMode;
            const body = document.getElementById('bodyTag');
            const header = document.getElementById('headerTag');
            const ratesCard = document.getElementById('ratesCard');
            const inputCard = document.getElementById('inputCard');
            const graphCard = document.getElementById('graphCard');
            const themeBtn = document.getElementById('themeBtn');
            const themeIcon = document.getElementById('themeIcon');
            const tasaBCV = document.getElementById('tasaBCV');
            const tasaUSDT = document.getElementById('tasaUSDT');
            const badgeLabel = document.getElementById('badgeLabel');
            const brechaBox = document.getElementById('brechaBox');
            const selectorBox = document.getElementById('selectorBox');
            const inputLabel = document.getElementById('inputLabel');
            const montoEntrada = document.getElementById('montoEntrada');
            const usdtResultCard = document.getElementById('usdtResultCard');
            const usdtIconBg = document.getElementById('usdtIconBg');
            const graphTitle = document.getElementById('graphTitle');
            const progBarBg1 = document.getElementById('progBarBg1');
            const progBarBg2 = document.getElementById('progBarBg2');
            const footerText = document.getElementById('footerText');
            const valUSDTDisplay = document.getElementById('valUSDTDisplay');

            if (darkMode) {
                body.classList.replace('bg-slate-50', 'bg-slate-900');
                body.classList.replace('text-slate-800', 'text-slate-100');
                header.classList.replace('bg-blue-700', 'bg-slate-800');
                ratesCard.classList.replace('bg-white', 'bg-slate-800');
                ratesCard.classList.replace('border-slate-100', 'border-slate-700');
                inputCard.classList.replace('bg-white', 'bg-slate-800');
                inputCard.classList.replace('border-blue-500/20', 'border-blue-500/30');
                graphCard.classList.replace('bg-white', 'bg-slate-800');
                graphCard.classList.replace('border-slate-100', 'border-slate-700');
                themeBtn.classList.replace('bg-blue-800', 'bg-slate-700');
                themeBtn.classList.replace('text-blue-100', 'text-yellow-400');
                badgeLabel.classList.replace('bg-slate-100', 'bg-slate-700');
                badgeLabel.classList.replace('text-slate-500', 'text-slate-400');
                brechaBox.classList.replace('bg-slate-50', 'bg-slate-900');
                selectorBox.classList.replace('bg-slate-100', 'bg-slate-900');
                inputLabel.classList.replace('text-slate-700', 'text-slate-300');
                montoEntrada.classList.replace('border-slate-100', 'border-slate-700');
                usdtResultCard.classList.replace('bg-white', 'bg-slate-800');
                usdtResultCard.classList.replace('border-slate-200', 'border-slate-700');
                valUSDTDisplay.classList.replace('text-slate-800', 'text-slate-100');
                usdtIconBg.classList.replace('bg-green-100', 'bg-green-900/30');
                graphTitle.classList.replace('text-slate-700', 'text-slate-300');
                progBarBg1.classList.replace('bg-slate-100', 'bg-slate-900');
                progBarBg2.classList.replace('bg-slate-100', 'bg-slate-900');
                footerText.classList.replace('text-slate-400', 'text-slate-500');
                
                tasaBCV.className = "w-full p-2 rounded-lg font-bold text-lg focus:outline-none focus:ring-2 bg-slate-700 border-slate-600 text-blue-400 focus:ring-blue-500 transition-colors duration-300";
                tasaUSDT.className = "w-full p-2 rounded-lg font-bold text-lg focus:outline-none focus:ring-2 bg-slate-700 border-slate-600 text-green-400 focus:ring-green-500 transition-colors duration-300";

                themeIcon.setAttribute('data-lucide', 'sun');
            } else {
                body.classList.replace('bg-slate-900', 'bg-slate-50');
                body.classList.replace('text-slate-100', 'text-slate-800');
                header.classList.replace('bg-slate-800', 'bg-blue-700');
                ratesCard.classList.replace('bg-slate-800', 'bg-white');
                ratesCard.classList.replace('border-slate-700', 'border-slate-100');
                inputCard.classList.replace('bg-slate-800', 'bg-white');
                inputCard.classList.replace('border-blue-500/30', 'border-blue-500/20');
                graphCard.classList.replace('bg-slate-800', 'bg-white');
                graphCard.classList.replace('border-slate-700', 'border-slate-100');
                themeBtn.classList.replace('bg-slate-700', 'bg-blue-800');
                themeBtn.classList.replace('text-yellow-400', 'text-blue-100');
                badgeLabel.classList.replace('bg-slate-700', 'bg-slate-100');
                badgeLabel.classList.replace('text-slate-400', 'text-slate-500');
                brechaBox.classList.replace('bg-slate-900', 'bg-slate-50');
                selectorBox.classList.replace('bg-slate-900', 'bg-slate-100');
                inputLabel.classList.replace('text-slate-300', 'text-slate-700');
                montoEntrada.classList.replace('border-slate-700', 'border-slate-100');
                usdtResultCard.classList.replace('bg-slate-800', 'bg-white');
                usdtResultCard.classList.replace('border-slate-700', 'border-slate-200');
                valUSDTDisplay.classList.replace('text-slate-100', 'text-slate-800');
                usdtIconBg.classList.replace('bg-green-900/30', 'bg-green-100');
                graphTitle.classList.replace('text-slate-300', 'text-slate-700');
                progBarBg1.classList.replace('bg-slate-900', 'bg-slate-100');
                progBarBg2.classList.replace('bg-slate-900', 'bg-slate-100');
                footerText.classList.replace('text-slate-500', 'text-slate-400');

                tasaBCV.className = "w-full p-2 rounded-lg font-bold text-lg focus:outline-none focus:ring-2 bg-blue-50 border-blue-100 text-blue-900 focus:ring-blue-500 transition-colors duration-300";
                tasaUSDT.className = "w-full p-2 rounded-lg font-bold text-lg focus:outline-none focus:ring-2 bg-green-50 border-green-100 text-green-900 focus:ring-green-500 transition-colors duration-300";

                themeIcon.setAttribute('data-lucide', 'moon');
            }
            localStorage.setItem('ve-calc-theme', darkMode ? 'dark' : 'light');
            lucide.createIcons();
            setCurrency(monedaEntrada);
        }

        function setCurrency(cur) {
            monedaEntrada = cur;
            const buttons = document.querySelectorAll('.currency-btn');
            buttons.forEach(btn => {
                btn.className = "currency-btn flex-1 py-2 text-xs font-bold rounded-lg transition-all text-slate-500";
            });

            const activeBtn = document.getElementById('btn' + cur);
            if (darkMode) {
                activeBtn.className = "currency-btn flex-1 py-2 text-xs font-bold rounded-lg transition-all bg-slate-700 text-blue-400 shadow-lg";
            } else {
                activeBtn.className = "currency-btn flex-1 py-2 text-xs font-bold rounded-lg transition-all bg-white text-blue-700 shadow-sm scale-105";
            }

            document.getElementById('inputLabel').innerText = `Monto en ${cur}`;
            calculate();
        }

        function updateRates() {
            const bcv = parseFloat(document.getElementById('tasaBCV').value) || 0;
            const usdt = parseFloat(document.getElementById('tasaUSDT').value) || 0;
            
            if (bcv > 0 && usdt > 0) {
                const brecha = ((usdt - bcv) / bcv) * 100;
                const brechaText = document.getElementById('brechaText');
                brechaText.innerText = `+${brecha.toFixed(2)}%`;
                brechaText.className = `font-bold ${brecha > 15 ? 'text-red-500' : 'text-amber-500'}`;
                
                localStorage.setItem('ve-calc-rates', JSON.stringify({ bcv, usdt }));
            }
            calculate();
        }

        function calculate() {
            const monto = parseFloat(document.getElementById('montoEntrada').value) || 0;
            const bcv = parseFloat(document.getElementById('tasaBCV').value) || 1;
            const usdt = parseFloat(document.getElementById('tasaUSDT').value) || 1;
            const resultsArea = document.getElementById('resultsArea');

            if (monto <= 0) {
                resultsArea.classList.add('hidden');
                return;
            }

            resultsArea.classList.remove('hidden');

            let montoEnBs = 0;
            if (monedaEntrada === 'BS') montoEnBs = monto;
            else if (monedaEntrada === 'USD') montoEnBs = monto * bcv;
            else if (monedaEntrada === 'USDT') montoEnBs = monto * usdt;

            const valUSD = montoEnBs / bcv;
            const valUSDT = montoEnBs / usdt;

            const bsBox = document.getElementById('bsResultBox');
            if (monedaEntrada === 'BS') {
                bsBox.classList.add('hidden');
            } else {
                bsBox.classList.remove('hidden');
                document.getElementById('valBS').innerText = formatVEF(montoEnBs);
            }

            document.getElementById('valUSD').innerText = formatUSD(valUSD);
            document.getElementById('valUSDTDisplay').innerText = formatUSD(valUSDT);
            
            document.getElementById('progUSD').innerText = formatUSD(valUSD);
            document.getElementById('progUSDT').innerText = formatUSD(valUSDT);
            
            const pct = (valUSD > 0) ? (valUSDT / valUSD) * 100 : 0;
            document.getElementById('realProgress').style.width = `${pct}%`;
        }
    </script>
</body>
</html>
